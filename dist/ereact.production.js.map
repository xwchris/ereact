{"version":3,"sources":["webpack://EReact/webpack/universalModuleDefinition","webpack://EReact/webpack/bootstrap","webpack://EReact/./src/createElement.js","webpack://EReact/./src/constants.js","webpack://EReact/./src/component.js","webpack://EReact/./src/utils.js","webpack://EReact/./src/diff.js","webpack://EReact/./src/render.js","webpack://EReact/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","createElement","type","attributes","_ref","clonedAttributes","assign","_len","arguments","length","children","Array","_key","filteredChildren","concat","apply","vnode","ATTR_KEY","willRenderQueue","Component","props","context","this","_dirty","state","_renderCallbacks","setState","callback","prevState","push","renderComponent","forceUpdate","render","createComponent","Constructor","inst","constructor","setComponentProps","component","base","componentWillReceiveProps","componentWillMount","prevProps","prevContext","renderMode","isUpdate","isForceRender","skipRender","shouldComponentUpdate","componentWillUpdate","rendered","getChildContext","diff","componentDidMount","componentDidUpdate","_component","pop","func","Promise","resolve","then","setTimeout","defer","willRenderedComponent","idiff","dom","out","parentNode","nodeType","nodeValue","document","createTextNode","replaceChild","componentWillUnmount","buildComponentFromVNode","nodeName","toLowerCase","firstChild","appendChild","diffChildren","diffAttribute","attrs","oldAttrs","setAccessor","undefined","originChildren","childNodes","originChild","child","resultChild","removeChild","console","error","_typeof","style","innerHTML","__html","startsWith","useCapture","endsWith","eventType","substring","addEventListener","eventProxy","removeEventListener","_listener","setAttribute","e","parent","rdom","container","__webpack_exports__"],"mappings":"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","file":"ereact.production.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"EReact\"] = factory();\n\telse\n\t\troot[\"EReact\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\n/**\n * vnode constructor\n */\nfunction VNode () {}\n\n/**\n * Create VNode element\n *\n * @param { string | function } type\n * @param { object } attributes\n * @param { Array(VNode) } children\n *\n * @return { VNode } vnode\n */\n\nconst createElement = (type, attributes, ...children) => {\n\n  // shallow copy attribute\n  const clonedAttributes = Object.assign({}, attributes);\n\n  // flatten children and filter children\n  const filteredChildren = [].concat(...children);\n\n  // create and assign vnode\n  const vnode = new VNode();\n\n  clonedAttributes.children = filteredChildren;\n\n  vnode.type = type;\n  vnode.attributes = clonedAttributes;\n  vnode.children = filteredChildren;\n\n  return vnode;\n}\n\nexport default createElement;\n","const ATTR_KEY = '@react/__attr_key__';\n\n// Render mode constants\nconst SYNC_RENDER = '@react/render_sync';\nconst ASYNC_RENDER = '@react/render_async';\nconst FORCE_RENDER = '@react/force_update';\n\nexport { ATTR_KEY, SYNC_RENDER, ASYNC_RENDER, FORCE_RENDER };\n","import diff from './diff';\nimport { FORCE_RENDER, SYNC_RENDER, ASYNC_RENDER } from './constants';\nimport { defer } from './utils';\n\nconst willRenderQueue = [];\n\n/**\n * Component Class which need to be inherited by component\n *\n * @param {Object} props the props to be initialized\n * @param {Object} context the context to be initialized\n *\n */\n\nfunction Component (props, context) {\n\n  // preact is true, here not understand\n  this._dirty = false;\n\n  this.props = props;\n  this.state = this.state || {};\n  this.context = context || {};\n\n  this._renderCallbacks = [];\n}\n\nObject.assign(Component.prototype, {\n  /**\n   * Change component state\n   *\n   * @param {Object} state the state will be set\n   * @param {Function} callback callback after the component rendered\n   *\n   */\n\n  setState: function (state, callback) {\n    if (!this.prevState) this.prevState = this.state;\n    this.state = Object.assign({}, this.state, state);\n    if (callback) this._renderCallbacks.push(callback);\n    renderComponent(this, ASYNC_RENDER);\n  },\n\n\n  /**\n   * Update component force which means ignore shouldComponentUpdate hook value\n   *\n   * @param {Function} callback callback after the component rendered\n   */\n\n  forceUpdate: function(callback) {\n    if (callback) this._renderCallbacks.push(callback);\n    renderComponent(this, FORCE_RENDER);\n  },\n\n\n  /**\n   * Default render function\n   */\n\n  render: function() {}\n})\n\n/**\n * build component from VNode\n *\n * @param {Element} dom the dom to be contrasted\n * @param {VNode} vnode virtual node which will be used to create component\n * @param {Object} context component context\n *\n * @return component's root dom\n */\n\nconst buildComponentFromVNode = (dom, vnode, context) => {\n  const props = vnode.attributes;\n\n  let inst;\n  if (dom == null || dom._component == null || dom._component.constructor !== vnode.type) {\n    inst = createComponent(vnode.type, props, context);\n\n    const needUnmount = !!(dom && dom._component);\n    if (needUnmount && dom._component.componentWillUnmount) {\n      dom._component.componentWillUnmount();\n    }\n  } else {\n    inst = dom._component;\n  }\n\n  setComponentProps(inst, props, context);\n  return inst.base;\n}\n\n/**\n * create component instance\n *\n * @param {Function} Constructor component constructor which is class or function\n * @param {Object} props the props to be initialized\n * @param {Object} context the context to be initialized\n *\n * @return component instance\n */\n\nconst createComponent = (Constructor, props, context) => {\n  let inst;\n  if (Constructor.prototype && Constructor.prototype.render) {\n    inst = new Constructor(props, context);\n    Component.call(inst, props, context);\n  } else {\n    inst = new Component(props, context);\n    inst.render = () => Constructor(props, context);\n  }\n\n  inst.constructor = Constructor;\n  return inst;\n}\n\n/**\n * Set component props\n *\n * @param {Component} component component which will attach props\n * @param {Object} props the props to be attached\n * @param {Object} context via context\n *\n */\n\nconst setComponentProps = (component, props, context) => {\n  if (!component.base) {\n    if (component.componentWillMount) component.componentWillMount();\n  } else if (component.componentWillReceiveProps){\n    component.componentWillReceiveProps(props);\n  }\n\n  if (!component.prevProps) component.prevProps = component.props;\n  if (!component.prevContext) component.prevContext = component.context;\n  component.props = props;\n\n  renderComponent(component, SYNC_RENDER, context);\n}\n\n/**\n * Render component to dom element\n *\n * @param {Component} component component instance to render\n * @param {string} renderMode render mode\n * @param {Object} context context to be transported to children\n *\n */\n\nconst renderComponent = (component, renderMode, context) => {\n  const props = component.props;\n  const state = component.state;\n  const prevProps = component.prevProps || props;\n  const prevState = component.prevState || state;\n  const prevContext = component.prevContext || context;\n  const isUpdate = !!component.base;\n  const isForceRender = renderMode === FORCE_RENDER;\n  let skipRender = false;\n\n  // async render\n  if (renderMode === ASYNC_RENDER) {\n    if (!component._dirty && willRenderQueue.push(component) === 1) {\n      component._dirty = true;\n\n      defer(() => {\n        const willRenderedComponent = willRenderQueue.pop();\n        if (willRenderedComponent._dirty) renderComponent(willRenderedComponent, SYNC_RENDER, context);\n      })\n    }\n    return;\n  }\n\n  component._dirty = false;\n\n  if (isUpdate) {\n    component.props = prevProps;\n    component.state = prevState;\n    component.context = prevContext;\n    if (!isForceRender && component.shouldComponentUpdate && component.shouldComponentUpdate(props, state) === false) {\n      skipRender = true;\n    } else if (component.componentWillUpdate) {\n      component.componentWillUpdate(props, state);\n    }\n    component.props = props;\n    component.state = state;\n    component.context = context;\n  }\n\n  component.prevProps = component.prevState = component.prevContext = null;\n\n  if (!skipRender) {\n    const rendered = component.render();\n    if (component.getChildContext) {\n      context = Object.assign({}, context, component.getChildContext());\n    }\n    const base = diff(component.base, rendered, null, context);\n    component.base = base;\n\n    if (!isUpdate && component.componentDidMount) {\n      component.componentDidMount();\n    } else if (isUpdate && component.componentDidUpdate) {\n      component.componentDidUpdate(prevProps, prevState);\n    }\n\n    base._component = component;\n  }\n\n  while (component._renderCallbacks.length) component._renderCallbacks.pop().call(component);\n}\n\nexport { buildComponentFromVNode, Component };\n","/**\n * Create an duplicate-free version of an array which only the first occurrence of each element is kept.\n *\n * @param {Array} array the array to inspect\n *\n * @return the new duplicate free array\n *\n */\n\nconst uniq = array =>\n  array.slice().reverse()\n  .filter((item, index) => array.lastIndexOf(item) === index)\n  .reverse();\n\n\n/**\n * Defers invoking function until the current call stack has cleared\n *\n * @param {Function} func the function will defer\n *\n */\n\nconst defer = func => {\n  if (typeof Promise === 'function') {\n    Promise.resolve().then(func);\n  } else {\n    setTimeout(func);\n  }\n}\n\nexport { uniq, defer };\n","import { buildComponentFromVNode } from './component';\nimport { ATTR_KEY } from './constants';\n\n/**\n * Reconciliation method\n *\n * @param { dom } dom given dom\n * @param { VNode } vnode vnode to diff\n * @param { dom } parent the dom vnode need to mount\n *\n * @return the result dom\n */\n\nconst diff = (dom, vnode, parent, context) => {\n\n  const rdom = idiff(dom, vnode, context);\n\n  if (parent && rdom.parentNode !== parent) {\n    parent.appendChild(rdom);\n  }\n  return rdom;\n}\n\n/**\n * Internal reconciliation method\n *\n * @param { dom } dom given dom\n * @param { VNode } vnode vnode to diff\n *\n * @return { dom } result dom\n */\n\nexport const idiff = (dom, vnode, context) => {\n  let out = dom;\n\n  if (vnode == null || typeof vnode === 'boolean') {\n    vnode = ''\n  }\n\n  // update or create a node\n  if (typeof vnode === 'string' || typeof vnode === 'number') {\n    if (dom && dom.parentNode && dom.nodeType === 3) {\n      if (dom.nodeValue !== vnode) {\n        dom.nodeValue = vnode;\n      }\n    } else {\n      out = document.createTextNode(vnode);\n      if (dom && dom.parentNode) dom.parentNode.replaceChild(out, dom);\n    }\n    return out;\n  }\n\n  if (typeof vnode.type === 'function') {\n    return buildComponentFromVNode(dom, vnode, context);\n  }\n\n  if (!dom || dom.nodeName.toLowerCase() !== vnode.type) {\n    out = document.createElement(vnode.type);\n    if (dom) {\n      while (dom.firstChild) out.appendChild(dom.firstChild);\n      if (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n    }\n  }\n\n  // these two functions can't swap position\n  // because diffAttributes may set dangerouslySetInnerHTML which can change the structure\n  diffChildren(out, vnode.children, context);\n  diffAttribute(out, vnode.attributes);\n\n  return out;\n}\n\n/**\n * Diff attributes\n *\n * @param { dom } dom dom to diff\n * @param { object } attrs attributes need to diff\n */\n\nconst diffAttribute = (dom, attrs) => {\n  const oldAttrs = dom[ATTR_KEY] || {};\n\n  for (name in oldAttrs) {\n    if (!(attrs && attrs[name] != null) && oldAttrs[name] != null) {\n      setAccessor(dom, name, undefined);\n    }\n  }\n\n  for (name in attrs) {\n    if (!(name in oldAttrs) || attrs[name] !== (name === 'value' || name === 'checked' ? dom[name] : oldAttrs[name])) {\n      setAccessor(dom, name, attrs[name]);\n    }\n  }\n}\n\n\n/**\n * Diff children\n *\n * @param {dom} dom dom to diff\n * @param {array} children vnode children\n */\n\nconst diffChildren = (dom, children, context) => {\n  const originChildren = dom.childNodes;\n  const length = children.length;\n  for (let i = 0; i < length; i++) {\n    const originChild = originChildren[i];\n    const child = children[i];\n    const resultChild = idiff(originChild, child, context);\n\n    if (originChild !== resultChild) {\n      if (originChild == null) {\n        dom.appendChild(resultChild);\n      } else {\n        dom.replaceChild(resultChild, originChild);\n      }\n    }\n  }\n\n  if (originChildren.length > length) {\n    for (let i = originChildren.length - 1; i >= length; i--) {\n      dom.removeChild(originChildren[i]);\n    }\n  }\n}\n\n\n/**\n * Set dom attribute\n *\n * @param {dom} dom target dom\n * @param {string} name the property name\n * @param {any} value the property value\n *\n */\n\nconst setAccessor = (dom, name, value) => {\n  dom[ATTR_KEY] = dom[ATTR_KEY] || {};\n  if (value != null) {\n    dom[ATTR_KEY][name] = value;\n  }\n\n  // className htmlFor\n  if (name === 'className') {\n    name = 'class';\n  }\n\n  if (name === 'htmlFor') {\n    name = 'for';\n  }\n\n  if (name === 'key' || name === 'children' || name === 'innerHTML') {\n    // ignore\n  } else if (name === 'ref' && value != null) {\n    if (typeof value === 'function') {\n      value(dom);\n    } else {\n      console.error('ref should be an function');\n    }\n  } else if (name === 'style') {\n    if (typeof value === 'object') {\n      for (let i in value) {\n        dom.style[i] = typeof value[i] === 'number' ? `${value[i]}px` : value[i];\n      }\n    }\n\n    if (typeof value === 'string' || value == null) {\n      dom.style = value;\n    }\n  } else if (name === 'dangerouslySetInnerHTML') {\n    if (typeof value === 'object') {\n      dom.innerHTML = value.__html;\n    }\n  } else if (name.startsWith('on')) {\n    const useCapture = name.endsWith('Capture');\n    const eventType = name.toLowerCase().substring(2);\n    if (value) {\n      dom.addEventListener(eventType, eventProxy, useCapture);\n    } else {\n      dom.removeEventListener(eventType, eventProxy, useCapture);\n    }\n    (dom._listener || (dom._listener = {}))[eventType] = value;\n  } else {\n    dom.setAttribute(name, value);\n  }\n}\n\n/**\n * event proxy\n *\n * @param {event} e event\n */\nfunction eventProxy(e) {\n  return this._listener[e.type]();\n}\n\nexport default diff;\n","import diff from './diff';\n\n/**\n * render VNode\n *\n * @param {VNode} vnode virtual node\n * @param {Element} container the container dom element\n *\n */\n\nconst render = (vnode, container) => {\n  diff(null, vnode, container, {});\n}\n\nexport default render;\n","import createElement from './createElement';\nimport render from './render';\nimport { Component } from './component';\n\nexport default { createElement, render, Component };\n"],"sourceRoot":""}